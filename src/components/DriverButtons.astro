---
import { drivers } from "./DriverCards.astro";
---

<div class="col-span-1 mx-auto transition-all duration-300">
  <div
    id="drivers-container"
    class="flex justify-center items-center flex-wrap gap-6 p-8"
  >
    {
      drivers.map((driver, index) => (
        <button
          data-car-img={driver.carImgUrl}
          data-car-number={driver.carNumber}
          data-driver-name={driver.name}
          data-nationality={driver.nationality}
          data-flag={driver.natImgUrl}
          data-index={index}
          class={`driver-btn flex justify-center items-center bg-linear-135 from-yellow-500/50 to-purple-900 border border-purple-950 font-semibold text-2xl w-20 aspect-square rounded-full shadow-lg overflow-hidden hover:scale-105 hover:bg-yellow-500 transform transition duration-300 ${index === 0 ? "ring-2 ring-purple-600 bg-yellow-500" : ""}`}
        >
          <p>{driver.carNumber}</p>
        </button>
      ))
    }
  </div>
  <!-- Pagination controls for mobile -->
  <div
    id="pagination-controls"
    class="flex md:hidden justify-center items-center gap-4 mt-6"
  >
    <button
      id="prev-page"
      class="bg-gray-700 hover:bg-gray-600 text-white font-bold py-2 px-4 rounded-full disabled:opacity-30 disabled:cursor-not-allowed transition-all"
      aria-label="Previous page"
    >
      <svg
        class="w-5 h-5"
        fill="none"
        stroke="currentColor"
        viewBox="0 0 24 24"
      >
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          stroke-width="2"
          d="M15 19l-7-7 7-7"></path>
      </svg>
    </button>
    <span id="page-indicator" class="text-white font-semibold">1 / 1</span>
    <button
      id="next-page"
      class="bg-gray-700 hover:bg-gray-600 text-white font-bold py-2 px-4 rounded-full disabled:opacity-30 disabled:cursor-not-allowed transition-all"
      aria-label="Next page"
    >
      <svg
        class="w-5 h-5"
        fill="none"
        stroke="currentColor"
        viewBox="0 0 24 24"
      >
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          stroke-width="2"
          d="M9 5l7 7-7 7"></path>
      </svg>
    </button>
  </div>
</div>

<script>
  // Pagination for mobile
  const driversPerPage = 6;
  let currentPage = 0;
  const driverButtons = document.querySelectorAll(".driver-btn");

  const totalDrivers = driverButtons.length;
  const totalPages = Math.ceil(totalDrivers / driversPerPage);

  const prevBtn = document.getElementById("prev-page");
  const nextBtn = document.getElementById("next-page");
  const pageIndicator = document.getElementById("page-indicator");

  function updatePagination() {
    // Hide all buttons first
    driverButtons.forEach((btn, index) => {
      const button = btn as HTMLElement;
      const start = currentPage * driversPerPage;
      const end = start + driversPerPage;

      if (window.innerWidth < 768) {
        // Mobile: show only current page
        if (index >= start && index < end) {
          button.style.display = "flex";
        } else {
          button.style.display = "none";
        }
      } else {
        // Desktop: show all
        button.style.display = "flex";
      }
    });

    // Update page indicator
    if (pageIndicator) {
      pageIndicator.textContent = `${currentPage + 1} / ${totalPages}`;
    }

    // Update button states
    if (prevBtn) {
      (prevBtn as HTMLButtonElement).disabled = currentPage === 0;
    }
    if (nextBtn) {
      (nextBtn as HTMLButtonElement).disabled = currentPage === totalPages - 1;
    }
  }

  if (prevBtn) {
    prevBtn.addEventListener("click", () => {
      if (currentPage > 0) {
        currentPage--;
        updatePagination();
      }
    });
  }

  if (nextBtn) {
    nextBtn.addEventListener("click", () => {
      if (currentPage < totalPages - 1) {
        currentPage++;
        updatePagination();
      }
    });
  }

  // Update on resize
  window.addEventListener("resize", () => {
    updatePagination();
  });

  // Initial update
  updatePagination();
</script>
