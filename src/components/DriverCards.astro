---
import { fetchDrivers } from "../lib/strapi";
import { strapiUrl } from "../lib/strapi";

export const drivers = await fetchDrivers();
---

<div
  id="car-display"
  class="flex flex-col justify-center items-center min-h-[400px] md:min-h-[500px] bg-gray-800/70 rounded-2xl p-4 md:p-12 border-2 border-purple-500/30 hover:border-purple-500/50 transition-all duration-300 shadow-xl shadow-purple-500/10"
>
  <img
    id="car-image"
    src={`${strapiUrl}/${drivers[0].driverImg.url}`}
    alt={`Car #${drivers[0].carNumber}`}
    class="w-full md:w-auto md:scale-115 h-auto rounded-lg transition-opacity duration-300"
  />
  <h4
    class="text-2xl md:text-3xl text-white transition-opacity duration-300 mt-4 md:mt-6 font-bold"
  >
    {drivers[0].driverName}
  </h4>
  <small class="text-gray-300 transition-opacity duration-300 mt-2 text-base"
    ><img
      src={`${strapiUrl}/${drivers[0].countryFlag.url}`}
      alt={drivers[0].nationality}
      class="inline w-6 h-4 mr-2"
    />{drivers[0].nationality}</small
  >
</div>

<!-- Script to handle driver button clicks and update car display -->
<script>
  document.addEventListener("DOMContentLoaded", () => {
    const carImage = document.getElementById("car-image") as HTMLImageElement;
    const driverButtons = document.querySelectorAll(".driver-btn");

    driverButtons.forEach((button) => {
      button.addEventListener("click", () => {
        const carImg = button.getAttribute("data-car-img");
        const carNumber = button.getAttribute("data-car-number");
        const driverName = button.getAttribute("data-driver-name");
        const nationality = button.getAttribute("data-nationality");
        const flag = button.getAttribute("data-flag");

        const driverNameElement = document.querySelector(
          "#car-display h4"
        ) as HTMLElement;
        const nationalityElement = document.querySelector(
          "#car-display small img"
        ) as HTMLImageElement;
        const nationalityTextElement = document.querySelector(
          "#car-display small"
        ) as HTMLElement;

        if (carImage && carImg && driverName && nationality && flag) {
          // Fade out all elements
          carImage.style.opacity = "0";
          if (driverNameElement) {
            driverNameElement.style.opacity = "0";
          }
          if (nationalityTextElement) {
            nationalityTextElement.style.opacity = "0";
          }

          setTimeout(() => {
            // Update content
            carImage.src = carImg;
            carImage.alt = `Car #${carNumber}`;

            if (driverNameElement) {
              driverNameElement.textContent = driverName;
            }
            if (nationalityElement) {
              nationalityElement.src = flag;
              nationalityElement.alt = nationality;
            }
            if (nationalityTextElement) {
              const textNode = nationalityTextElement.childNodes[1];
              if (textNode) {
                textNode.nodeValue = nationality;
              }
            }

            // Fade in all elements
            carImage.style.opacity = "1";
            if (driverNameElement) {
              driverNameElement.style.opacity = "1";
            }
            if (nationalityTextElement) {
              nationalityTextElement.style.opacity = "1";
            }
          }, 150);
        }

        // Update active ring
        driverButtons.forEach((btn) => {
          btn.classList.remove("ring-2", "ring-purple-600", "bg-yellow-500");
        });
        button.classList.add("ring-2", "ring-purple-600", "bg-yellow-500");
      });
    });
  });
</script>
